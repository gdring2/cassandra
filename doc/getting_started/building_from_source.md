#  Building Cassandra

This document explains how build Cassandra from source code. If you don't need to modify Cassandra or test an unreleased patch, then you should probably install Cassandra from a binary tarball as explained in [installation](installation.md).

## Prerequisites 

* [Git](https://git-scm.com/downloads), version 1.8 or later.

* [Java SE JDK version 8](http://www.oracle.com/technetwork/java/javase/downloads/index.html), preferably the latest version.

* [Ant](https://ant.apache.org/bindownload.cgi) version 1.9 or later

* [Python 2.7](https://www.python.org/downloads/), if you intend to run cqlsh.


## Get the source code

Clone the Cassandra git repository:

```git clone https://git-wip-us.apache.org/repos/asf/cassandra.git cassandra```

Then check out the branch you need according to the following table:

| Cassandra version | Branch name  | Notes  |
| :---------------:|:-------------:| :-----:|
| Cassandra 2.1    | cassandra-2.1 | Critical fixes or regressions only |
| Cassandra 2.2    | cassandra-2.2 | Bug fixes only |
| Cassandra 3.0.x  | cassandra-3.0 | Bug fixes only |
| Cassandra 3.x    | cassandra-3.x | Bug fixes only |
| Not yet released | trunk         | Bug fixes and new features |

To checkout a branch:
 
```git checkout branch-name```. 

Always choose the oldest applicable version, then after the patch is reviewed, it can be merged upwards. 

You can find more branches representing older Cassandra versions via: `git branch -a`. Releases are also tagged. To fid a tag for a release use `git tag`, you can also checkout the tag of a specific release.


## Building

To build type:

```
cd cassandra
ant
```

The build will download files so you need a network connection. If you are connected via a proxy then use `ant -autoproxy`.

###  Troubleshooting

If you have problems:
 
* Ensure that `CASSANDRA_HOME` is pointing to the correct JDK and that `java -version` returns the expected version. 

* Check that your version of ANT meets the minimum required version. On RH/Centos systems you may need additional ant dependencies, try running: `yum install ant ant-apache-*`
   
* Check that you have an Internet connection. The build has to download Maven ANT Tasks (or Ivy for older builds) and the download all the required build dependencies. If you don't have an internet connection, or if ANT cannot determine your proxy configuration then the build will fail. 

* Try with a `ant clean` and `ant realclean`.

## Staying up-to-date

To update a cloned repository with recent commits:
 
```git pull```

We strongly suggest that you work from a feature branch, as describe in the example below, and keep it up-to-date with the release branch by rebasing periodically. This way a pull will simply be a fast forward of the release branches, with no conflicts to resolve.

## Example

Let's develop a new feature corresponding to Jira ticket CASSANDRA-1234:

```
git clone https://git-wip-us.apache.org/repos/asf/cassandra.git cassandra
cd cassandra
git checkout trunk
git checkout -b 1234
ant build
```

Now you are ready to work. Later on, to update:

```
git checkout trunk
git pull
git checkout 1234
git rebase trunk
```

You may need to resolve conflicts during the rebase.

To develop a fix for release 3.0.x, the steps are the same except for:

```
git checkout cassandra-3.0
git checkout -b 1234-3.0
```
and

```
git checkout cassandra-3.0
git pull
git checkout 1234-3.0
git rebase cassandra-3.0
```

Later, after the patch is reviewed, it will also be merged upwards, refer to [how to commit](https://wiki.apache.org/cassandra/HowToCommit) for more details.

##  Building Tools

All tools are built with `ant build` with the exception of cassandra-stress, which is built with `ant stress-build`.
  
## Using IDEs

We support two IDEs, [IntelliJ IDEA](https://www.jetbrains.com/idea/download) and [Eclipse](https://eclipse.org/downloads/).

### IntelliJ IDEA

Since version 2.1.5 type:
 
 ```ant generate-idea-files```
 
This will generate an IDEA project file, `cassandra.iml` that you can open in IDEA.

For older versions of Cassandra, generate an Eclipse project file as explained below and then import it into IDEA. Refer to [this page](https://wiki.apache.org/cassandra/RunningCassandraInIDEA) for more details.

### Eclipse

Type:

```ant generate-eclipse-files```

This will generate an Eclipse project file, `.project` that you can open in Eclipse.

The projects generated by the ant tasks above should contain everything needed to debug Cassandra and execute unit tests:

* Run/debug defaults for JUnit
* Run/debug configuration for Cassandra daemon
* License header for Java source files
* Cassandra code style
* Inspections 


## Building older versions

To build older versions you need older prerequisites:

| Cassandra version | Java SDK |   GIT   |   ANT  |
| :---------------: |:--------:| :-----: | :-----:|
| 2.0 | 1.7 | 1.7+ | 1.8+ |
| 1.2 and older | 1.6 | 1.7+ | 1.8+ |

# Testing and Coverage

Refer to [testing](testing.md).


